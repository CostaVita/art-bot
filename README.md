# Art Bot - Telegram Bot для связи с администратором

Этот проект представляет собой Telegram бота на Spring Boot, который позволяет пользователям отправлять сообщения администратору и получать ответы.

## Функциональность

### Для пользователей:
- Отправка текстовых сообщений администратору
- Отправка медиа файлов (фото, видео, документы, голосовые сообщения, аудио, стикеры)
- Получение ответов от администратора

### Для администратора:
- Просмотр всех сообщений от пользователей
- Ответы пользователям через команду `/reply`
- Просмотр списка активных пользователей через команду `/users`
- Ответы на сообщения через reply (ответ на пересланное сообщение)

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/reply <ID пользователя> <текст ответа>` - Ответить пользователю (только для администратора)
- `/users` - Показать список активных пользователей (только для администратора)

## Настройка

### 1. Получение токена бота

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 2. Получение ID администратора

1. Найдите @userinfobot в Telegram
2. Отправьте любое сообщение
3. Сохраните полученный ID

### 3. Настройка переменных окружения

#### Быстрая настройка (рекомендуется):

**Windows:**
```bash
setup_env.bat
```

#### Ручная настройка:

Создайте файл `.env` в корне проекта или установите переменные окружения:

```bash
# Токен вашего бота (получить у @BotFather)
BOT_TOKEN=your_bot_token_here

# Username вашего бота (без @)
BOT_USERNAME=your_bot_username

# ID администратора (получить у @userinfobot)
ADMIN_ID=your_admin_id_here
```

### 4. Настройка application.properties

Отредактируйте файл `src/main/resources/application.properties`:

```properties
# Telegram Bot Configuration
telegram.bot.token=${BOT_TOKEN:your_bot_token_here}
telegram.bot.username=${BOT_USERNAME:your_bot_username}

# Admin Configuration
bot.admin.id=${ADMIN_ID:0}
```

## Запуск

### Требования
- Java 17 или выше
- Maven 3.6 или выше

### Важно!
**Администратор должен сначала написать боту команду `/start`, иначе бот не сможет отправлять ему сообщения!**

### Команды для запуска

#### Быстрый запуск (рекомендуется):

**Windows:**
```bash
run_bot.bat
```

**Полный запуск с проверками:**
```bash
start_bot.bat
```

**Linux/Mac:**
```bash
chmod +x start_bot.sh
./start_bot.sh
```

#### Ручной запуск:

1. Сборка проекта:
```bash
mvn clean package
```

2. Запуск:
```bash
java -jar target/art-bot-1.0-SNAPSHOT.jar
```

Или через Maven:
```bash
mvn spring-boot:run
```

## Структура проекта

```
src/
├── main/
│   ├── java/org/example/
│   │   ├── bot/
│   │   │   └── AdminBot.java          # Основной класс бота
│   │   ├── config/
│   │   │   ├── BotConfig.java         # Конфигурация бота
│   │   │   └── TelegramBotConfig.java # Конфигурация Telegram API
│   │   ├── model/
│   │   │   └── User.java              # Модель пользователя
│   │   ├── service/
│   │   │   └── UserService.java       # Сервис управления пользователями
│   │   └── Main.java                  # Главный класс приложения
│   └── resources/
│       └── application.properties     # Конфигурация приложения
```

## Логирование

Логи сохраняются в файл `bot.log` в корне проекта. Уровень логирования можно настроить в `application.properties`.

## Безопасность

- Бот проверяет ID администратора перед выполнением административных команд
- Все сообщения пользователей пересылаются только администратору
- Ответы могут отправлять только пользователи с ID администратора

## Поддерживаемые типы сообщений

- Текстовые сообщения
- Фото
- Видео
- Документы
- Голосовые сообщения
- Аудио файлы
- Стикеры

## Устранение неполадок

### Проверка конфигурации

Запустите скрипт проверки конфигурации:

**Windows:**
```bash
check_config.bat
```

**Полное тестирование:**
```bash
test_config.bat
```

### Частые проблемы

1. **Ошибка "Error removing old webhook" или "404 Not Found"**:
   - Проверьте правильность токена бота
   - Убедитесь, что бот создан у @BotFather
   - Проверьте, что токен скопирован полностью

2. **Ошибка "BOT_TOKEN не настроен"**:
   - Установите переменную окружения: `set BOT_TOKEN=ваш_токен`
   - Или отредактируйте `application.properties`

3. **Ошибка "ADMIN_ID не настроен"**:
   - Получите ваш ID у @userinfobot
   - Установите переменную окружения: `set ADMIN_ID=ваш_id`
   - Или отредактируйте `application.properties`

4. **Бот не отвечает**: 
   - Проверьте логи в файле `bot.log`
   - Убедитесь, что бот запущен и подключен к Telegram

5. **Команды администратора не работают**: 
   - Проверьте правильность ADMIN_ID
   - Убедитесь, что вы являетесь администратором бота

6. **Проблемы с кодировкой (кракозябры в сообщениях)**:
   - Запустите `check_encoding.bat` для проверки кодировки
   - Убедитесь, что консоль использует UTF-8: `chcp 65001`
   - Используйте скрипт `start_bot.bat` для автоматической настройки кодировки
   - Проверьте, что Java запускается с параметрами `-Dfile.encoding=UTF-8`

## Лицензия

Этот проект создан для образовательных целей. 